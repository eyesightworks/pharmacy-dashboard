<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hospital Pharmacy Pro ‚Äì v5</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
:root {
  --bg:#0f172a; --panel:#111827; --card:#1f2933; --text:#e5e7eb; --muted:#9ca3af;
  --accent:#22c55e; --danger:#ef4444; --warning:#f59e0b;
}
*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,sans-serif;}
body{background:var(--bg);color:var(--text);display:flex;min-height:100vh;}
.hidden{display:none;}
input,select{padding:.5rem;margin:.3rem 0;background:#020617;border:1px solid #374151;color:var(--text);}
button{padding:.5rem .8rem;border:none;cursor:pointer;}
button.action{background:var(--accent);color:#052e16;}
button.danger{background:var(--danger);color:#fff;}
.card{background:var(--card);padding:1rem;border-radius:8px;margin-bottom:1rem;}
table{width:100%;border-collapse:collapse;}
th,td{padding:.5rem;border-bottom:1px solid #374151;text-align:left;}
th{color:var(--muted);}
aside{width:260px;background:var(--panel);padding:1rem;transition:.3s;}
aside h2{margin-bottom:1rem;}
aside button{width:100%;margin-bottom:.5rem;text-align:left;color:var(--text);background:var(--card);}
aside button.active{background:var(--accent);color:#052e16;display:flex;justify-content:space-between;align-items:center;}
main{flex:1;padding:1rem;overflow-y:auto;}
.hamburger{display:none;font-size:1.5rem;cursor:pointer;margin-bottom:1rem;}
@media(max-width:768px){aside{position:fixed;height:100%;transform:translateX(-100%);z-index:1000;}
aside.open{transform:translateX(0);}
.hamburger{display:block;}
.overlay{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);z-index:900;}
.overlay.show{display:block;}
}
.login{margin:auto;background:var(--card);padding:2rem;border-radius:12px;width:90%;max-width:400px;text-align:center;}
.login input{width:80%;margin:0.5rem 0;}
.login button{width:50%;margin-top:1rem;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginBox" class="login">
  <h2>Hospital Pharmacy Login</h2>
  <input id="username" placeholder="Username"><br>
  <input id="password" type="password" placeholder="Password"><br>
  <button id="loginBtn">Login</button>
  <p id="loginMsg"></p>
</div>

<!-- APP -->
<aside id="sidebar" class="hidden">
  <h2>üè• Hospital Pharmacy Pro</h2>
  <button data-view="dashboard" class="active">Dashboard</button>
  <button data-view="inventory">Inventory</button>
  <button data-view="sales">Sales</button>
  <button data-view="activity">Activity Log</button>
  <button id="backupBtn">Backup</button>
  <button id="restoreBtn">Restore</button>
</aside>

<div class="overlay" id="overlay"></div>

<main id="mainApp" class="hidden">
  <span class="hamburger" id="hamburger">‚ò∞</span>

  <section id="dashboard" class="view">
    <div class="card">
      <h3>Overview</h3>
      <p>Total Medicines: <span id="statMedicines">0</span></p>
      <p>Total Sales: <span id="statSales">0</span></p>
    </div>
    <canvas id="salesChart"></canvas>
  </section>

  <section id="inventory" class="view hidden">
    <div class="card">
      <h3>Add Medicine</h3>
      <input id="medName" placeholder="Name">
      <input id="medQty" type="number" placeholder="Qty">
      <input id="medExp" type="date">
      <button class="action" id="addMed">Add</button>
    </div>
    <div class="card">
      <h3>Inventory</h3>
      <table>
        <thead><tr><th>Name</th><th>Qty</th><th>Expiry</th><th></th></tr></thead>
        <tbody id="inventoryTable"></tbody>
      </table>
    </div>
  </section>

  <section id="sales" class="view hidden">
    <div class="card">
      <h3>Cart</h3>
      <select id="saleSelect"></select>
      <input id="saleQty" type="number" value="1">
      <button class="action" id="addToCart">Add</button>
      <table>
        <thead><tr><th>Item</th><th>Qty</th></tr></thead>
        <tbody id="cartTable"></tbody>
      </table>
      <button class="action" id="checkout">Checkout</button>
    </div>
  </section>

  <section id="activity" class="view hidden">
    <div class="card">
      <h3>Activity Log</h3>
      <ul id="activityList"></ul>
    </div>
  </section>
</main>

<script>
// ========== LOGIN ==========
const loginBox = document.getElementById('loginBox');
const mainApp = document.getElementById('mainApp');
const sidebar = document.getElementById('sidebar');
const loginMsg = document.getElementById('loginMsg');

document.getElementById('loginBtn').onclick = ()=>{
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value.trim();
  if(user==='admin' && pass==='admin'){
    loginBox.classList.add('hidden');
    sidebar.classList.remove('hidden');
    mainApp.classList.remove('hidden');
    initApp();
  }else loginMsg.textContent = "Invalid credentials! Use admin/admin";
};

// ========== STATE ==========
const state = {
  inventory: JSON.parse(localStorage.getItem('inventory')||'[]'),
  salesLog: JSON.parse(localStorage.getItem('salesLog')||'[]'),
  activity: JSON.parse(localStorage.getItem('activity')||'[]'),
  cart: [],
  undoStack: [], redoStack:[]
};

function save(){ 
  localStorage.setItem('inventory',JSON.stringify(state.inventory));
  localStorage.setItem('salesLog',JSON.stringify(state.salesLog));
  localStorage.setItem('activity',JSON.stringify(state.activity));
}

// ========== APP INIT ==========
function initApp(){
  setupNav();
  renderInventory();
  renderCart();
  renderActivity();
  renderSalesChart();
  updateDashboard();
}

// ========== NAVIGATION ==========
const hamburger = document.getElementById('hamburger');
const overlay = document.getElementById('overlay');

hamburger.onclick = ()=>{ sidebar.classList.toggle('open'); overlay.classList.toggle('show'); };
overlay.onclick = ()=>{ sidebar.classList.remove('open'); overlay.classList.remove('show'); };

function setupNav(){
  document.querySelectorAll('aside button[data-view]').forEach(btn=>{
    btn.onclick = ()=>{
      document.querySelectorAll('.view').forEach(v=>v.classList.add('hidden'));
      document.getElementById(btn.dataset.view).classList.remove('hidden');
      document.querySelectorAll('aside button').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      sidebar.classList.remove('open'); overlay.classList.remove('show');
    };
  });
}

// ========== INVENTORY ==========
const inventoryTable = document.getElementById('inventoryTable');

function saveState(){
  state.undoStack.push(JSON.stringify({inventory:state.inventory,salesLog:state.salesLog}));
  if(state.undoStack.length>20) state.undoStack.shift();
  state.redoStack=[];
}

function renderInventory(){
  inventoryTable.innerHTML='';
  state.inventory.forEach((m,i)=>{
    const expired = new Date(m.expiry)<new Date();
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${m.name}</td><td>${m.qty}</td><td class="${expired?'danger':''}">${m.expiry}</td>
      <td><button class="danger" onclick="deleteMed(${i})">X</button></td>`;
    inventoryTable.appendChild(tr);
  });
  renderSalesSelect(); updateDashboard();
}

function deleteMed(i){
  saveState();
  log(`Deleted medicine: ${state.inventory[i].name}`);
  state.inventory.splice(i,1);
  save(); renderInventory();
}

document.getElementById('addMed').onclick = ()=>{
  const name=medName.value.trim(), qty=+medQty.value, exp=medExp.value;
  if(!name||qty<=0||!exp) return alert('Invalid input');
  if(new Date(exp)<new Date()) return alert('Cannot add expired medicine');
  saveState();
  state.inventory.push({name,qty,expiry:exp});
  log(`Added medicine: ${name}`);
  save(); renderInventory();
};

// ========== SALES ==========
const saleSelect = document.getElementById('saleSelect');
const cartTable = document.getElementById('cartTable');

function renderSalesSelect(){
  saleSelect.innerHTML='';
  state.inventory.forEach((m,i)=>{
    if(m.qty>0 && new Date(m.expiry)>=new Date()){
      const o=document.createElement('option'); o.value=i; o.textContent=m.name;
      saleSelect.appendChild(o);
    }
  });
}

function renderCart(){
  cartTable.innerHTML='';
  state.cart.forEach(c=>{
    const tr=document.createElement('tr'); tr.innerHTML=`<td>${c.name}</td><td>${c.qty}</td>`; cartTable.appendChild(tr);
  });
}

document.getElementById('addToCart').onclick = ()=>{
  const idx=+saleSelect.value, qty=+saleQty.value, med=state.inventory[idx];
  if(!med||qty<=0||qty>med.qty) return alert('Invalid quantity');
  state.cart.push({name:med.name,qty});
  renderCart();
};

document.getElementById('checkout').onclick = ()=>{
  if(!state.cart.length) return alert('Cart empty');
  saveState();
  state.cart.forEach(c=>{ const med=state.inventory.find(m=>m.name===c.name); med.qty-=c.qty; });
  state.salesLog.push({id:crypto.randomUUID(), items:[...state.cart], time:new Date().toLocaleString()});
  log('Checkout completed');
  state.cart=[]; save(); renderInventory(); renderCart(); renderSalesChart();
};

// ========== DASHBOARD ==========
const statMedicines = document.getElementById('statMedicines');
const statSales = document.getElementById('statSales');
const ctx = document.getElementById('salesChart').getContext('2d');

let salesChart = new Chart(ctx,{type:'bar',data:{labels:[],datasets:[{label:'Qty Sold',data:[],backgroundColor:'#22c55e'}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});

function renderSalesChart(){
  const labels = state.salesLog.map((s,i)=>`Sale ${i+1}`);
  const data = state.salesLog.map(s=>s.items.reduce((a,b)=>a+b.qty,0));
  salesChart.data.labels = labels; salesChart.data.datasets[0].data = data; salesChart.update();
}

function updateDashboard(){ statMedicines.textContent=state.inventory.length; statSales.textContent=state.salesLog.length; }

// ========== ACTIVITY ==========
function log(msg){ state.activity.unshift({msg,time:new Date().toLocaleString()}); if(state.activity.length>100) state.activity.pop(); save(); renderActivity(); }
function renderActivity(){ const activityList=document.getElementById('activityList'); activityList.innerHTML=''; state.activity.forEach(a=>{ const li=document.createElement('li'); li.textContent=`${a.time} ‚Äî ${a.msg}`; activityList.appendChild(li); }); }

// ========== BACKUP / RESTORE ==========
document.getElementById('backupBtn').onclick = ()=>{
  const blob=new Blob([JSON.stringify(state)],{type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='pharmacy-backup.json'; a.click(); log('Backup exported');
};

document.getElementById('restoreBtn').onclick = ()=>{
  const input=document.createElement('input'); input.type='file'; input.accept='application/json';
  input.onchange=(e)=>{ const file=e.target.files[0]; const reader=new FileReader(); reader.onload=()=>{
    const restored=JSON.parse(reader.result);
    state.inventory=restored.inventory||[]; state.salesLog=restored.salesLog||[]; state.activity=restored.activity||[];
    save(); renderInventory(); renderSalesChart(); renderActivity(); log('Backup restored');
  }; reader.readAsText(file); }; input.click();
};
</script>
</body>
</html>
